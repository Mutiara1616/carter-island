// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
  previewFeatures = ["metrics"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model User {
  id          String     @id @default(cuid())
  email       String     @unique
  username    String?    @unique
  password    String
  firstName   String?    @map("first_name")
  lastName    String?    @map("last_name")
  role        Role       @default(USER)
  status      UserStatus @default(ACTIVE)
  
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  lastLoginAt DateTime?  @map("last_login_at")
  
  department  String?
  position    String?
  phone       String?
  
  sessions    Session[]
  
  @@index([email, status])
  @@index([status, role])
  @@index([lastLoginAt])
  @@map("users")
}

model Session {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  token       String   @unique
  expiresAt   DateTime @map("expires_at")
  createdAt   DateTime @default(now()) @map("created_at")
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent")
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, expiresAt])
  @@index([expiresAt])
  @@index([token])
  @@map("sessions")
}

model ActivityLog {
  id          String   @id @default(cuid())
  userId      String?  @map("user_id")
  action      String
  resource    String?
  description String?  @db.Text
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  
  @@index([userId, createdAt])
  @@index([action, createdAt])
  @@index([createdAt])
  @@map("activity_logs")
}